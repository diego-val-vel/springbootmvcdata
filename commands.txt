# Levantar los contenedores
docker compose up -d

# Acceder al contenedor de desarrollo
docker compose exec springdev bash

# Dentro del contenedor: preparar entorno
apt-get update
apt-get upgrade -y
apt-get install -y curl wget git unzip zip ca-certificates gnupg software-properties-common build-essential apt-transport-https fontconfig httpie jq postgresql-client
apt-get install -y openjdk-21-jdk maven gradle

# Variables de entorno para Java
echo 'export JAVA_HOME=/usr/lib/jvm/java-21-openjdk-amd64' >/etc/profile.d/java.sh
echo 'export PATH=$JAVA_HOME/bin:$PATH' >>/etc/profile.d/java.sh
. /etc/profile.d/java.sh

# Verificar herramientas Java/Maven
java -version
mvn -version

# Instalar Node.js 20
curl -fsSL https://deb.nodesource.com/setup_20.x -o /tmp/nodesource_setup.sh
bash /tmp/nodesource_setup.sh
apt-get install -y nodejs
node -v

# Compilar proyecto
mvn -q -DskipTests package

# ===
# Uso de perfiles
# ===

# Default
mvn spring-boot:run

# Test
mvn spring-boot:run -Dspring-boot.run.profiles=test

# Prod
mvn spring-boot:run -Dspring-boot.run.profiles=prod

# ===
# Curls práctica 2
# ===

# Dentro del contenedor
cd /workspace
mvn spring-boot:run

# Probar /actuator/health desde el host
curl http://localhost:8080/actuator/health

# Probar creación de pre-reserva (caso correcto)
curl -i \
  -H "Content-Type: application/json" \
  -d '{
    "guestName": "Juan Pérez",
    "roomType": "STANDARD",
    "numberOfNights": 3
  }' \
  http://localhost:8080/api/pre-bookings

# Probar validación (error de Bean Validation), nombre vacío y noches 0
curl -i \
  -H "Content-Type: application/json" \
  -d '{
    "guestName": "",
    "roomType": "STANDARD",
    "numberOfNights": 0
  }' \
  http://localhost:8080/api/pre-bookings

# Probar consulta por id (caso encontrado)
curl -i http://localhost:8080/api/pre-bookings/1

# Probar consulta por id inexistente (BookingNotFoundException)
curl -i http://localhost:8080/api/pre-bookings/999
